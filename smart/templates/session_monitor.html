<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart-Pulse - Sesión</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8a5c2 0%, #f093c0 100%);
            min-height: 100vh;
            display: flex;
        }

        .sidebar {
            width: 200px;
            background: #2d3748;
            padding: 20px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            padding: 0 20px 30px;
            color: white;
            font-size: 18px;
            font-weight: bold;
        }

        .heart-icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            fill: #f093c0;
        }

        .nav-item {
            padding: 15px 20px;
            color: #a0aec0;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: rgba(240, 147, 192, 0.1);
            color: white;
            border-left-color: #f093c0;
        }

        .nav-item.active {
            background: rgba(240, 147, 192, 0.2);
            color: white;
            border-left-color: #f093c0;
        }

        .main-content {
            flex: 1;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .session-header {
            width: 100%;
            max-width: 1200px;
            margin-bottom: 30px;
        }

        .session-title {
            font-size: 48px;
            font-weight: bold;
            color: white;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .user-info {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 25px;
            color: white;
            text-align: center;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .session-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            width: 100%;
            max-width: 1200px;
            flex: 1;
        }

        .monitor-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
        }

        .heart-display {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .heart-display::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .heart-icon-large {
            width: 120px;
            height: 120px;
            fill: white;
            margin-bottom: 20px;
            animation: heartbeat 1s infinite;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .connection-status {
            font-size: 16px;
            color: white;
            opacity: 0.9;
        }

        .bpm-display {
            background: #2d3748;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .bpm-value {
            font-size: 64px;
            font-weight: bold;
            color: #f093c0;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
        }

        .bpm-label {
            font-size: 18px;
            color: #a0aec0;
        }

        .session-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 2px solid #e0e0e0;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
        }

        .control-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
        }

        .control-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .btn {
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-start {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: white;
        }

        .btn-start:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(74, 222, 128, 0.3);
        }

        .btn-stop {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .btn-stop:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(239, 68, 68, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .session-info {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .session-info h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .info-label {
            color: #666;
        }

        .info-value {
            font-weight: 600;
            color: #2d3748;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .status-connected {
            background: #dcfce7;
            color: #166534;
            border: 2px solid #bbf7d0;
        }

        .status-disconnected {
            background: #fef2f2;
            color: #991b1b;
            border: 2px solid #fecaca;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-connected .status-dot {
            background: #22c55e;
        }

        .status-disconnected .status-dot {
            background: #ef4444;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .chart-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            border: 2px dashed #ddd;
        }

        @media (max-width: 1024px) {
            .session-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .session-title {
                font-size: 36px;
            }
            
            .main-content {
                padding: 20px;
            }
        }

        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 10px 0;
            }
            
            .session-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo">
            <svg class="heart-icon" viewBox="0 0 24 24">
                <path d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5 2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.04L12,21.35Z"/>
            </svg>
            Smart-Pulse
        </div>
        <div class="nav-item">Registro</div>
        <div class="nav-item active">Sesión</div>
        <div class="nav-item">Historial</div>
        <div class="nav-item">Configuración</div>
    </div>

    <div class="main-content">
        <div class="session-header">
            <h1 class="session-title">Sesión de Monitoreo</h1>
            <div class="user-info" id="userInfo">
                <strong>Usuario:</strong> <span id="userName">Cargando...</span> | 
                <strong>Edad:</strong> <span id="userAge">--</span> | 
                <strong>Género:</strong> <span id="userGender">--</span>
            </div>
        </div>

        <div class="session-container">
            <div class="monitor-panel">
                <div class="heart-display">
                    <svg class="heart-icon-large" viewBox="0 0 24 24">
                        <path d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5 2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.04L12,21.35Z"/>
                    </svg>
                    <div class="connection-status" id="connectionStatus">
                        Esperando conexión del sensor...
                    </div>
                </div>

                <div class="bpm-display">
                    <div class="bpm-value" id="bpmValue">--</div>
                    <div class="bpm-label">BPM</div>
                </div>

                <div class="session-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="avgBpm">--</div>
                        <div class="stat-label">Promedio</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="maxBpm">--</div>
                        <div class="stat-label">Máximo</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="minBpm">--</div>
                        <div class="stat-label">Mínimo</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="duration">00:00</div>
                        <div class="stat-label">Duración</div>
                    </div>
                </div>

                <div class="chart-container">
                    <span>Gráfico de frecuencia cardíaca en tiempo real</span>
                </div>
            </div>

            <div class="control-panel">
                <div class="status-indicator" id="statusIndicator">
                    <div class="status-dot"></div>
                    <span id="statusText">Desconectado</span>
                </div>

                <div class="control-buttons">
                    <button class="btn btn-start" id="startBtn">
                        Iniciar Sesión
                    </button>
                    <button class="btn btn-stop" id="stopBtn" disabled>
                        Detener Sesión
                    </button>
                </div>

                <div class="session-info">
                    <h3>Información de la Sesión</h3>
                    <div class="info-row">
                        <span class="info-label">Estado:</span>
                        <span class="info-value" id="sessionState">Inactiva</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Inicio:</span>
                        <span class="info-value" id="sessionStart">--</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Lecturas:</span>
                        <span class="info-value" id="readingCount">0</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Zona FC:</span>
                        <span class="info-value" id="heartZone">--</span>
                    </div>
                </div>

                <div class="session-info">
                    <h3>Rangos de FC</h3>
                    <div class="info-row">
                        <span class="info-label">Reposo:</span>
                        <span class="info-value" id="restingHR">60-100 bpm</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Aeróbico:</span>
                        <span class="info-value" id="aerobicHR">--</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Anaeróbico:</span>
                        <span class="info-value" id="anaerobicHR">--</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Máximo:</span>
                        <span class="info-value" id="maxHR">--</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let sessionActive = false;
        let sessionStartTime = null;
        let bpmReadings = [];
        let currentBpm = 0;
        let readingCount = 0;
        let durationInterval = null;

        // Cargar datos del usuario
        function loadUserData() {
            const userData = localStorage.getItem('userData');
            if (userData) {
                const user = JSON.parse(userData);
                document.getElementById('userName').textContent = user.nombre;
                document.getElementById('userAge').textContent = user.edad;
                document.getElementById('userGender').textContent = user.genero;
                
                // Calcular rangos de FC basados en edad y género
                calculateHeartRateZones(user);
            }
        }

        // Calcular zonas de frecuencia cardíaca
        function calculateHeartRateZones(user) {
            const age = parseInt(user.edad);
            const maxHR = 220 - age;
            const aerobicLow = Math.round(maxHR * 0.7);
            const aerobicHigh = Math.round(maxHR * 0.8);
            const anaerobicLow = Math.round(maxHR * 0.8);
            const anaerobicHigh = Math.round(maxHR * 0.9);

            document.getElementById('maxHR').textContent = maxHR + ' bpm';
            document.getElementById('aerobicHR').textContent = `${aerobicLow}-${aerobicHigh} bpm`;
            document.getElementById('anaerobicHR').textContent = `${anaerobicLow}-${anaerobicHigh} bpm`;
        }

        // Determinar zona de FC actual
        function getHeartZone(bpm, maxHR) {
            if (bpm < maxHR * 0.6) return 'Reposo';
            if (bpm < maxHR * 0.7) return 'Recuperación';
            if (bpm < maxHR * 0.8) return 'Aeróbica';
            if (bpm < maxHR * 0.9) return 'Anaeróbica';
            return 'Máxima';
        }

        // Iniciar sesión
        function startSession() {
            sessionActive = true;
            sessionStartTime = new Date();
            bpmReadings = [];
            readingCount = 0;

            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('sessionState').textContent = 'Activa';
            document.getElementById('sessionStart').textContent = sessionStartTime.toLocaleTimeString();

            // Iniciar temporizador de duración
            durationInterval = setInterval(updateDuration, 1000);

            // Simular conexión (aquí conectarías con tu servidor Flask)
            setTimeout(() => {
                updateConnectionStatus(true);
                startReceivingData();
            }, 2000);
        }

        // Detener sesión
        function stopSession() {
            sessionActive = false;
            
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('sessionState').textContent = 'Finalizada';

            clearInterval(durationInterval);
            updateConnectionStatus(false);

            // Guardar datos de la sesión
            saveSessionData();
        }

        // Actualizar duración
        function updateDuration() {
            if (!sessionStartTime) return;
            
            const now = new Date();
            const diff = now - sessionStartTime;
            const minutes = Math.floor(diff / 60000);
            const seconds = Math.floor((diff % 60000) / 1000);
            
            document.getElementById('duration').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Actualizar estado de conexión
        function updateConnectionStatus(connected) {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            const connectionStatus = document.getElementById('connectionStatus');

            if (connected) {
                indicator.className = 'status-indicator status-connected';
                statusText.textContent = 'Conectado';
                connectionStatus.textContent = 'Sensor conectado - Recibiendo datos';
            } else {
                indicator.className = 'status-indicator status-disconnected';
                statusText.textContent = 'Desconectado';
                connectionStatus.textContent = 'Esperando conexión del sensor...';
            }
        }

        // Simular recepción de datos (aquí conectarías con tu servidor Flask)
        function startReceivingData() {
            const interval = setInterval(() => {
                if (!sessionActive) {
                    clearInterval(interval);
                    return;
                }

                // Simular BPM (reemplaza con datos reales de tu servidor)
                const simulatedBpm = Math.floor(Math.random() * 40) + 60; // 60-100 bpm
                updateBpmDisplay(simulatedBpm);
            }, 1000);
        }

        // Actualizar display de BPM
        function updateBpmDisplay(bpm) {
            currentBpm = bpm;
            bpmReadings.push(bpm);
            readingCount++;

            document.getElementById('bpmValue').textContent = bpm;
            document.getElementById('readingCount').textContent = readingCount;

            // Calcular estadísticas
            const avgBpm = Math.round(bpmReadings.reduce((a, b) => a + b, 0) / bpmReadings.length);
            const maxBpm = Math.max(...bpmReadings);
            const minBpm = Math.min(...bpmReadings);

            document.getElementById('avgBpm').textContent = avgBpm;
            document.getElementById('maxBpm').textContent = maxBpm;
            document.getElementById('minBpm').textContent = minBpm;

            // Actualizar zona de FC
            const userData = localStorage.getItem('userData');
            if (userData) {
                const user = JSON.parse(userData);
                const age = parseInt(user.edad);
                const maxHR = 220 - age;
                document.getElementById('heartZone').textContent = getHeartZone(bpm, maxHR);
            }
        }

        // Guardar datos de la sesión
        function saveSessionData() {
            const sessionData = {
                startTime: sessionStartTime,
                endTime: new Date(),
                readings: bpmReadings,
                avgBpm: bpmReadings.length > 0 ? Math.round(bpmReadings.reduce((a, b) => a + b, 0) / bpmReadings.length) : 0,
                maxBpm: bpmReadings.length > 0 ? Math.max(...bpmReadings) : 0,
                minBpm: bpmReadings.length > 0 ? Math.min(...bpmReadings) : 0,
                duration: document.getElementById('duration').textContent
            };

            // Guardar en localStorage (aquí enviarías a tu servidor)
            const sessions = JSON.parse(localStorage.getItem('sessions') || '[]');
            sessions.push(sessionData);
            localStorage.setItem('sessions', JSON.stringify(sessions));

            console.log('Sesión guardada:', sessionData);
        }

        // Event listeners
        document.getElementById('startBtn').addEventListener('click', startSession);
        document.getElementById('stopBtn').addEventListener('click', stopSession);

        // Navegación
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Inicializar
        loadUserData();
    </script>
</body>
</html>